<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MNie | Migration from old format of cs/fsproj to the new one</title>
  <meta name="description" content="Migration from .net framework csproj/fsproj to the .net core csproj/fsproj isn't an easy task. There are some caveats around it, checkout article to find some of them.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Migration from old format of cs/fsproj to the new one">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://mnie.me/migrationfromoldtonewprojectfile">
  <meta property="og:description" content="Migration from .net framework csproj/fsproj to the .net core csproj/fsproj isn't an easy task. There are some caveats around it, checkout article to find some of them.">
  <meta property="og:site_name" content="MNie">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://mnie.me/migrationfromoldtonewprojectfile">
  <meta name="twitter:title" content="Migration from old format of cs/fsproj to the new one">
  <meta name="twitter:description" content="Migration from .net framework csproj/fsproj to the .net core csproj/fsproj isn't an easy task. There are some caveats around it, checkout article to find some of them.">

  
    
      <meta property="og:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
      <meta name="twitter:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
    
  

  <link href="http://mnie.me/feed.xml" type="application/rss+xml" rel="alternate" title="MNie Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-8d94e1b2ced7d843d882416da48ad6b7a0386071412905b6048dbe8205e32559.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-03c296a876e33d932966817b36fde1212bdb044fb0585145cde98ac98da59715.png">
      <link rel="stylesheet" type="text/css" href="/assets/dark-52a5e7e150abd939a150d09a93ec31ffd219b9e01c09465a899f36f3654beef1.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="MNie">MNie</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/mnie8" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/mnie" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://stackoverflow.com/users/2947860" rel="noreferrer noopener" target="_blank" title="Stack Overflow">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-stackoverflow">
  <use href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow" xlink:href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/michał-niegrzybowski" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:michal.niegrzybowski@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Migration from old format of cs/fsproj to the new one</h1>
            <p>Migration from .net framework csproj/fsproj to the .net core csproj/fsproj isn't an easy task. There are some caveats around it, checkout article to find some of them.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    December 13, 2017
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      7 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/fsharp" title="See all posts with tag 'F#'">F#</a>
    
      
      <a href="/tag/microservices" title="See all posts with tag 'Microservices'">Microservices</a>
    
      
      <a href="/tag/csharp" title="See all posts with tag 'C#'">C#</a>
    
      
      <a href="/tag/netcore" title="See all posts with tag '.net core'">.net core</a>
    
      
      <a href="/tag/netframework" title="See all posts with tag '.net framework'">.net framework</a>
    
      
      <a href="/tag/patterns" title="See all posts with tag 'Patterns'">Patterns</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Hey,</p>

<p>recently, in my work I encountered problem of adding a nuget packege which targets .net standard to a project which targets .net framework. This caused problems when compiling the project.
In search of a possible solution I found an <a href="https://github.com/dotnet/standard/issues/410">issue on github</a>.</p>

<p>Due to this, I decided to migrate old csproj/fsproj files in libraries and console apps (windows services).
However, in project which contains msbuild tasks inside of a project file, or web projects, I decided to switch from operating on packages.config and project file for nuget packages to a packagereference in project file.
Each of such packagereference contains information about the version and name of a package.</p>

<p>I started by moving information about nuget packages from packages.config files + cs/fsprojs to packagereferences in cs/fsproj. It based on adding the following entry to the csproj file:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;RestoreProjectStyle&gt;</span>
    PackageReference
<span class="nt">&lt;/RestoreProjectStyle&gt;</span></code></pre></figure>

<p>Then I copied the content of the packages.config file and rewrote it to a single command for Package Manager Console to install all the nuget packages, you can do it with the following script, which gets the name and version of the package from the file whose path I pass as the first argument for the project which name I pass as the second argument.</p>

<script src="https://gist.github.com/MNie/35f43e66e68d300510ca3a6c308d06fd.js"></script>

<p>Since the command is ready, I could delete the packages.config file, at this moment I’m ready to execute the previously prepared command. After doing this, all nuget package references should be in one place at the bottom of project file and should looks like this:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Ben.Demystifier"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Version&gt;</span>0.0.5<span class="nt">&lt;/Version&gt;</span>
<span class="nt">&lt;/PackageReference&gt;</span></code></pre></figure>

<p>Moving to the conversion from the old format of fsproj file to the new one, I decided to prepare a minimal set of xml elements for the new format, which I pasted at the very beginning of the existing file.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net462<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>DD.AA<span class="nt">&lt;/RootNamespace&gt;</span>
    <span class="nt">&lt;AssemblyName&gt;</span>DD.AA<span class="nt">&lt;/AssemblyName&gt;</span>
    <span class="nt">&lt;Name&gt;</span>DD.AA<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Library<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;AppDesignerFolder&gt;</span>Properties<span class="nt">&lt;/AppDesignerFolder&gt;</span>
    <span class="nt">&lt;GenerateAssemblyInfo&gt;</span>false<span class="nt">&lt;/GenerateAssemblyInfo&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\GlobalAssemblyInfo.cs"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Link&gt;</span>Properties\GlobalAssemblyInfo.cs<span class="nt">&lt;/Link&gt;</span>
    <span class="nt">&lt;/Compile&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\VersionInfo.cs"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Link&gt;</span>Properties\VersionInfo.cs<span class="nt">&lt;/Link&gt;</span>
    <span class="nt">&lt;/Compile&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Util.Lib"</span> <span class="na">Version=</span><span class="s">"1.0.0.*"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\OtherProjectInSln.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Reference</span> <span class="na">Include=</span><span class="s">"Reference to some windows libs"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span></code></pre></figure>

<p>Then I changed the name of the project, assembly and default namespace. I copied the itemgroup section containing information about the files included in the project. Then I added all the references to the nuget packages as the packagereference section.
I delete the rest of the file, thanks to which the file finally takes the following form.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"FSharp.NET.Sdk;Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net462<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>DD.Parser<span class="nt">&lt;/RootNamespace&gt;</span>
    <span class="nt">&lt;AssemblyName&gt;</span>DD.Parser<span class="nt">&lt;/AssemblyName&gt;</span>
    <span class="nt">&lt;Name&gt;</span>DD.Parser<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Library<span class="nt">&lt;/OutputType&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"AssemblyInfo.fs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"SomeFile.fs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Content</span> <span class="na">Include=</span><span class="s">"App.config"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"FSharp.NET.Sdk"</span> <span class="na">Version=</span><span class="s">"1.0.*"</span> <span class="na">PrivateAssets=</span><span class="s">"All"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"FSharp.Core"</span> <span class="na">Version=</span><span class="s">"4.1.*"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Castle.Common.Lang"</span> <span class="na">Version=</span><span class="s">"3.0.13.*"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"FSharp.Data"</span> <span class="na">Version=</span><span class="s">"2.4.*"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"System.ValueTuple"</span> <span class="na">Version=</span><span class="s">"4.3.*"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"FSharp.Core"</span> <span class="na">Version=</span><span class="s">"4.1.*"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\DD.Contract\DD.Contract.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span></code></pre></figure>

<p>Now I am going to rewrite the csproj files, here I should point out one advantage of this migration in relation to f#, I do not have to specify files in the itemgroup section, but in this case I encountered some problems with files that remained in the repository, but were unplugged from the project, through which after changing to a new format appeared again in the project.</p>

<p>Simply overwriting projects for a new format or using packagesreferences instead of packages.config took some time, but it was rather a simple task. I could use programs that do it automatically for me, for example like <a href="https://github.com/hvanbakel/CsprojToVs2017">this</a>.</p>

<p>However, I preferred to do it on myself to have full control over what is happening in the file.
So, what are the advantages of switching to a new format?</p>

<ul>
  <li>Information about the nuget packages is in one place, and not as it was before in packages.config what could cause problems when someone installed the package, but did not rebuild the project/did not save it and push their changes into the repository,</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Newtonsoft.Json"</span> <span class="na">Version=</span><span class="s">"6.0.*"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span></code></pre></figure>

<ul>
  <li>We do not have to worry about whether the attached package is oriented to a good framework, because its version is deduced from the framework set in the project file,</li>
  <li>Transparency and readability of the file itself, thanks to which we can finally easily operate on it,</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net462<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>DD.Database<span class="nt">&lt;/RootNamespace&gt;</span>
    <span class="nt">&lt;AssemblyName&gt;</span>DD.Database<span class="nt">&lt;/AssemblyName&gt;</span>
    <span class="nt">&lt;Name&gt;</span>DD.Database<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Library<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;AppDesignerFolder&gt;</span>Properties<span class="nt">&lt;/AppDesignerFolder&gt;</span>
    <span class="nt">&lt;GenerateAssemblyInfo&gt;</span>false<span class="nt">&lt;/GenerateAssemblyInfo&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Common"</span> <span class="na">Version=</span><span class="s">"1.0.0.*"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\OtherProjectInSln.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Reference</span> <span class="na">Include=</span><span class="s">"Reference to some windows libs"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span></code></pre></figure>

<ul>
  <li>The length of the file itself has dropped from about 200-1000 lines to 20-80 (in my solution),
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/length.png" alt="length" /></li>
  <li>We can easily specify the range of packages that should be downloaded for a given project,</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Common"</span> <span class="na">Version=</span><span class="s">"1.0.*"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span></code></pre></figure>

<ul>
  <li>We do not have to unload the project in Visual Studio to edit the project file,
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/unload.png" alt="unload" /></li>
  <li>In the case of csproj files, we do not have to specify all files that are part of the project,</li>
  <li>It gives us instant information about bad versions of packages between projects,
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/downgrade.png" alt="downgrade" /></li>
  <li>Quick information about cycles detection in project references,
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/cycle.png" alt="cycle" /></li>
  <li>“Easy” migration to the .net core, potentially the only thing we have to do is to add a new targetframework,</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;TargetFramework&gt;</span>net462;netstandard2.0;and so on<span class="nt">&lt;/TargetFramework&gt;</span></code></pre></figure>

<ul>
  <li>Generating packages from the visual studio during the build process,
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/generate.png" alt="generate" /></li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;GeneratePackageOnBuild&gt;</span>true<span class="nt">&lt;/GeneratePackageOnBuild&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span></code></pre></figure>

<ul>
  <li>Packages are downloaded per machine, not per solution as it was before.</li>
</ul>

<p>Problems that I encountered while migrating?</p>
<ul>
  <li>Generating the assemblyinfo based on the linked global files in the entire repository. In the case of my project, projects within the repository may have the same versions, by which they linked the same fileinfo and versioninfo files, in the case of a new csproj format the asseblyinfo file is automatically generated. To disable automatic generation, you have to add the following line at the beginning of the file csproj,</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;GenerateAssemblyInfo&gt;</span>false<span class="nt">&lt;/GenerateAssemblyInfo&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span></code></pre></figure>

<ul>
  <li>Generating nuget packages using the nuget client from libraries based on the new project file format is <a href="https://github.com/NuGet/Home/issues/4491">not yet possible</a>,</li>
  <li>Migration of msbuild tasks is available, but not so <a href="https://github.com/Microsoft/msbuild/issues/2746">well documented</a>.
    <ul>
      <li>So if you have an xml like that:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;UsingTask</span> <span class="na">TaskName=</span><span class="s">"TransformXml"</span> <span class="na">AssemblyFile=</span><span class="s">"$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\Web\Microsoft.Web.Publishing.Tasks.dll"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"AfterCompile"</span> <span class="na">Condition=</span><span class="s">"Exists('App.$(Configuration).config')"</span><span class="nt">&gt;</span>
      <span class="c">&lt;!--Generate transformed app config in the intermediate directory--&gt;</span>
      <span class="nt">&lt;TransformXml</span> <span class="na">Source=</span><span class="s">"App.config"</span> <span class="na">Destination=</span><span class="s">"$(IntermediateOutputPath)$(TargetFileName).config"</span> <span class="na">Transform=</span><span class="s">"App.$(Configuration).config"</span> <span class="nt">/&gt;</span>
      <span class="c">&lt;!--Force build process to use the transformed configuration file from now on.--&gt;</span>
      <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;AppConfigWithTargetPath</span> <span class="na">Remove=</span><span class="s">"App.config"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;AppConfigWithTargetPath</span> <span class="na">Include=</span><span class="s">"$(IntermediateOutputPath)$(TargetFileName).config"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;TargetPath&gt;</span>$(TargetFileName).config<span class="nt">&lt;/TargetPath&gt;</span>
        <span class="nt">&lt;/AppConfigWithTargetPath&gt;</span>
      <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
    </code></pre></figure>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- you have to migrate it to something like that
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;UsingTask</span> <span class="na">TaskName=</span><span class="s">"TransformXml"</span> <span class="na">AssemblyFile=</span><span class="s">"$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\Web\Microsoft.Web.Publishing.Tasks.dll"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"ApplyConfigurationConfigFile"</span> <span class="na">AfterTargets=</span><span class="s">"PrepareForBuild"</span> <span class="na">Condition=</span><span class="s">"Exists('App.$(Configuration).config')"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;AppConfigWithTargetPath</span> <span class="na">Remove=</span><span class="s">"App.config"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;AppConfigWithTargetPath</span> <span class="na">Include=</span><span class="s">"$(IntermediateOutputPath)$(TargetFileName).config"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;TargetPath&gt;</span>$(TargetFileName).config<span class="nt">&lt;/TargetPath&gt;</span>
        <span class="nt">&lt;/AppConfigWithTargetPath&gt;</span>
      <span class="nt">&lt;/ItemGroup&gt;</span>
      <span class="nt">&lt;TransformXml</span> <span class="na">Source=</span><span class="s">"App.config"</span> <span class="na">Destination=</span><span class="s">"$(IntermediateOutputPath)$(TargetFileName).config"</span> <span class="na">Transform=</span><span class="s">"App.$(Configuration).config"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
    </code></pre></figure>

<ul>
  <li>Blindly following the fact that the creators of the packages know, understand, respect and use the “Semantic Versioning” can lead us up the garden path
<img src="https://mnie.github.com/img/13-12-2017CsProjMigration/sqlite.png" alt="sqlite" />.</li>
  <li>Compiled sources no longer go to bin/* folders, instead they go to bin/{targerFramework}/* folders,</li>
  <li>Problems encountered with the Visual studio version, due to the fact that a version of at least 15.2 is required to make everything work well,</li>
  <li>Problem with resharper build, which can not cope the new csproj file format or references to nuget packages, which could be found only in project files,</li>
  <li>Migration of web projects targeting the .net framework to the new framework is not possible at the moment,</li>
  <li>Problem with detection of Machine.Specifications/XUnit specs by Resharper <a href="https://github.com/machine/machine.specifications.runner.resharper/issues/73">issue</a>, and <a href="https://youtrack.jetbrains.com/issue/RSRP-467721">issue in resharper</a>.</li>
</ul>

<p>In summary, despite the large number of minuses, I think that the advantages prevail in the new project file format, thanks to which these projects are easier to manage and the files themselves are more concise and clear.</p>

<p>Thank you for reading :)</p>

<p><a href="https://mnie.github.io/CsProjMigration/index#/">Here is a presentation which I gave to my teammates</a></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Migration+from+old+format+of+cs/fsproj+to+the+new+one%20-%20http://mnie.me/migrationfromoldtonewprojectfile%20by%20@mnie8" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://mnie.me/migrationfromoldtonewprojectfile" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://chalk-1.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    2020
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-81299349-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-81299349-1');
  </script>


<script src="/assets/vendor-130c9c254effc51f3283620bc635851da7b99c20901216948f11ba72ee13317f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
