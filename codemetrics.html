<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MNie | Decrease technical debt with help of CodeMetrics</title>
  <meta name="description" content="It is important that code produced by us could be easily tested and managed. However, it must be borne in mind that the projects we do at work are not individual tasks, and dozens of people are working on them. However, it is well known that everyone can have a bad day that will cause a bad code to be written that will lead to headaches when we look at it after some time. In this article we gonna take a deep view of available options in .net ecosystem related to CodeMetrics.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Decrease technical debt with help of CodeMetrics">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://mnie.me/codemetrics">
  <meta property="og:description" content="It is important that code produced by us could be easily tested and managed. However, it must be borne in mind that the projects we do at work are not individual tasks, and dozens of people are working on them. However, it is well known that everyone can have a bad day that will cause a bad code to be written that will lead to headaches when we look at it after some time. In this article we gonna take a deep view of available options in .net ecosystem related to CodeMetrics.">
  <meta property="og:site_name" content="MNie">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://mnie.me/codemetrics">
  <meta name="twitter:title" content="Decrease technical debt with help of CodeMetrics">
  <meta name="twitter:description" content="It is important that code produced by us could be easily tested and managed. However, it must be borne in mind that the projects we do at work are not individual tasks, and dozens of people are working on them. However, it is well known that everyone can have a bad day that will cause a bad code to be written that will lead to headaches when we look at it after some time. In this article we gonna take a deep view of available options in .net ecosystem related to CodeMetrics.">

  
    
      <meta property="og:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
      <meta name="twitter:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
    
  

  <link href="http://mnie.me/feed.xml" type="application/rss+xml" rel="alternate" title="MNie Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-8d94e1b2ced7d843d882416da48ad6b7a0386071412905b6048dbe8205e32559.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-03c296a876e33d932966817b36fde1212bdb044fb0585145cde98ac98da59715.png">
      <link rel="stylesheet" type="text/css" href="/assets/dark-52a5e7e150abd939a150d09a93ec31ffd219b9e01c09465a899f36f3654beef1.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="MNie">MNie</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/mnie8" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/mnie" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://stackoverflow.com/users/2947860" rel="noreferrer noopener" target="_blank" title="Stack Overflow">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-stackoverflow">
  <use href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow" xlink:href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/michał-niegrzybowski" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:michal.niegrzybowski@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Decrease technical debt with help of CodeMetrics</h1>
            <p>It is important that code produced by us could be easily tested and managed. However, it must be borne in mind that the projects we do at work are not individual tasks, and dozens of people are working on them. However, it is well known that everyone can have a bad day that will cause a bad code to be written that will lead to headaches when we look at it after some time. In this article we gonna take a deep view of available options in .net ecosystem related to CodeMetrics.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    July 30, 2017
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      5 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/fsharp" title="See all posts with tag 'F#'">F#</a>
    
      
      <a href="/tag/git" title="See all posts with tag 'Git'">Git</a>
    
      
      <a href="/tag/cleancode" title="See all posts with tag 'Clean Code'">Clean Code</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Hi,</p>

<p>doing my daily work, I try my best, so that code which I produce is of the highest quality. It is important that it could be easily tested and managed. However, it must be borne in mind that the projects we do at work are not individual tasks, and dozens of people are working on them. However, it is well known that everyone can have a bad day that will cause a bad code to be written that will lead to headaches when we look at it after some time.</p>

<p>How can we control the quality of code that is produced in our team? The solution could be the code metrics available in Visual Studio, which allows us to statically analyze the code in terms of 5 parameters.
These parameters are:</p>

<ul>
  <li>Cyclomatic complexity - the complexity of branching methods in code;</li>
  <li>Maintainability index - measures ease of code management;</li>
  <li>Depth of inheritance;</li>
  <li>Class coupling - an index that corresponds to the relationship between classes;</li>
  <li>Lines of code - executable code lines.</li>
</ul>

<p>The way to improve each of these metrics is similar, just to improve the code (simple right ;)?). In this post I will focus on cyclomatic complexity. Due to the desire to decrease code debt in a project. At the same time without throwing suddenly at all the bad places. I decided that the best way is to divide the code due to 3 parameters.</p>

<p>The first one is already mentioned before cyclomatic complexity, the second is information about the last modification date, the last number of changes made in a given class (in the project in which I work, each class is in a separate file).
Having already an idea about on what data I want to operate, I had to go to get them. Code metrics can be get by exporting project statistics to a .csv file. We start by calculating code metrics. By right-clicking on the project and selecting from the context menu “Calculate Code Metrics”</p>

<p><img src="https://mnie.github.com/img/2017-07-30CodeMetrics/run.jpg" alt="project" /></p>

<p>After generating the statistics, we are going to export them to excel.</p>

<p><img src="https://mnie.github.com/img/2017-07-30CodeMetrics/result.jpg" alt="project" /></p>

<p>By clicking the green excel icon we can filter the exported data so that they contain only information about the projects/methods/namespaces that we want to analyze.</p>

<p>By going to the date of the last modification of the file, and the number of modifications to the file, I used 2 git commands that look like this:</p>

<script src="https://gist.github.com/MNie/91bd2beabbf872e9db34d1d7b96cf327.js"></script>

<script src="https://gist.github.com/MNie/e92a9570fd2154d7b6c04a45cb5fc841.js"></script>

<p>At this stage I had the data needed for the analysis. I need to determine which methods should be improved and on what values of metrics it should be determined. I decided that it was best to deal with functions that are often modified, modified recently, and have a high complexity as I said before. So I took the approach that I want to fetch methods that have the following attribute values:</p>

<ul>
  <li>Cyclomatic complexity &gt;= 5</li>
  <li>Last modification time &lt;= 4 weeks = 28 days</li>
  <li>Moderation rate &gt;= 5</li>
</ul>

<p>To achieve my goal I wrote a piece of F # program/script that uses the benefits of <a href="http://fsharp.github.io/FSharp.Data/library/CsvProvider.html">CsvProvider</a>. I started by declaring the types that represent the data I have:</p>

<script src="https://gist.github.com/MNie/ea7cd69e6bdf4fa3ef745aa35c766d11.js"></script>

<p>Then I created a type that will reflect the resulting file with methods that require changes:</p>

<script src="https://gist.github.com/MNie/89e086f0201b407df24cb2069e0ec5bb.js"></script>

<p>I’m interested in the name of the method that needs a change, all the attributes that decide that this method should be changed and where the file is located. What is interesting, that I use the “StructuredFormatDisplay” attribute, which allows you to overload the object’s “print” method while using “sprintf”% A “ourObject”. Thus, in the code responsible for the data connection, there will be no logic associated with the way of how the Info class should be displayed.</p>

<p>By going to the executable code, I started by loading the data and set the limit value for “4 weeks back”</p>

<script src="https://gist.github.com/MNie/cb94c28a04c7795541c0ed1cf8d5da43.js"></script>

<p>As I said before, I’m only interested in methods and I want to have information about them, so I wrote following piece of code:</p>

<script src="https://gist.github.com/MNie/16065ba51e795acab983a48b1acd500a.js"></script>

<p>It has the task of loading the data by proposing code metrics, going through all the lines, and filtering only the methods. Then it maps everything to the Info type. You can see here the use of the fileInformation function. We could right now based on variables names that this method returns the name of the file in which the method is located, the date of the last modification of the file, and the number of changes made to it.</p>

<p>This method looks like this:</p>

<script src="https://gist.github.com/MNie/a2599e4b2402a67e37724bd339be25f3.js"></script>

<p>For a given class, we declare a local function byName, which searches for files that end with the class name and the .cs extension because we are interested in C # files. Then we find the record corresponding to the file name in the data regarding the date of the last modification and the number of changes. Then we declare 3 variables, where the first contains the file name, or the value “File not found” when the file was not found, lastChange contains the date of the last modification, or the minimum date (DateTime.MinValue), and numberOfChanges contains the number File modification or 0 if no matching record was found. At the end, the tuple containing the three variables is returned.</p>

<p>Having data in this form, the next step was to filter it out based on attributes that were listed earlier with the corresponding values ​​(complexity == 5, lastEdit &gt;= fourWeeksAgo, howManyChanges &gt;= 5), then sorting the results descending by complexity and write result to the file so I could share this information also within the team.
The above steps were done using the following code:</p>

<script src="https://gist.github.com/MNie/be2210af500ef9b9e46c3802615c0263.js"></script>

<p>In summary, with tools available for C # developers (using Visual Studio), Code Metrics and Git’s console, we can somehow monitor the quality of our code and catch bits of code that should be repaired to make the product easier to manage and less complex for developers. By means of F # and DataProviders, we could see that F # also fulfills the role of scripting language in which we can easily process data sets to extract the most interesting information.</p>

<p>Thanks for reading!</p>

<ul>
  <li><a href="https://github.com/MNie/CodeMetrics">Source</a></li>
</ul>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Decrease+technical+debt+with+help+of+CodeMetrics%20-%20http://mnie.me/codemetrics%20by%20@mnie8" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://mnie.me/codemetrics" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://chalk-1.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    2020
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-81299349-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-81299349-1');
  </script>


<script src="/assets/vendor-130c9c254effc51f3283620bc635851da7b99c20901216948f11ba72ee13317f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
