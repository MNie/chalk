<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MNie | Visual Studio 15.6.0 vs .net like projects</title>
  <meta name="description" content="FSharp.Net.Sdk is not longer needed after newest update of Visual Studio. In this article you will find out why.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Visual Studio 15.6.0 vs .net like projects">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://mnie.me/visualstudiovsfsharp">
  <meta property="og:description" content="FSharp.Net.Sdk is not longer needed after newest update of Visual Studio. In this article you will find out why.">
  <meta property="og:site_name" content="MNie">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://mnie.me/visualstudiovsfsharp">
  <meta name="twitter:title" content="Visual Studio 15.6.0 vs .net like projects">
  <meta name="twitter:description" content="FSharp.Net.Sdk is not longer needed after newest update of Visual Studio. In this article you will find out why.">

  
    
      <meta property="og:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
      <meta name="twitter:image" content="http://mnie.me/assets/documentation/sample-image-0a264584b152aa8d86f61525d05ae1131787d0a1029aa1cb7e3e4148b5d34755.jpg">
    
  

  <link href="http://mnie.me/feed.xml" type="application/rss+xml" rel="alternate" title="MNie Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-8d94e1b2ced7d843d882416da48ad6b7a0386071412905b6048dbe8205e32559.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-03c296a876e33d932966817b36fde1212bdb044fb0585145cde98ac98da59715.png">
      <link rel="stylesheet" type="text/css" href="/assets/dark-52a5e7e150abd939a150d09a93ec31ffd219b9e01c09465a899f36f3654beef1.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="MNie">MNie</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/mnie8" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/mnie" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://stackoverflow.com/users/2947860" rel="noreferrer noopener" target="_blank" title="Stack Overflow">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-stackoverflow">
  <use href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow" xlink:href="/assets/stackoverflow-12ba59133ed134d26156d30f095e0222b6039395cf26f2fab0cb6ce3ef2db00d.svg#icon-stackoverflow"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/michaÅ‚-niegrzybowski" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:michal.niegrzybowski@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Visual Studio 15.6.0 vs .net like projects</h1>
            <p>FSharp.Net.Sdk is not longer needed after newest update of Visual Studio. In this article you will find out why.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    March 11, 2018
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      5 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/fsharp" title="See all posts with tag 'F#'">F#</a>
    
      
      <a href="/tag/visualstudio" title="See all posts with tag 'VisualStudio'">VisualStudio</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Hey,</p>

<p>at the beginning of this week, new Visual Studio 15.6.0 appeared. I decided to update my version to the newest one, because what possibly could go wrong?
Has Microsoft ever released a version of Visual Studio that did not <code class="highlighter-rouge">work</code> ;)?</p>

<p>Well, while the last dozen of updates did not cause any problems, this update caused a couple of them because Visual Studio starts to hang and shut down after a couple of seconds.
The solution, which was opened, (In fact, an attempt was made to open it) is a solution consisting of about 20 projects, 18 C# and 2 F#.
A quick fix of the sln file that based on excluding F# projects from sln allowed to determine what/who is potentially a problem for the latest version of Visual Studio.
It turned out that F# projects that specify Microsoft.SDK and Fsharp.SDK caused Visual Studio to hang and following information was logged by Visual Studio:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">LimitedFunctionality</span>
<span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">Project</span> <span class="n">system</span> <span class="n">data</span> <span class="n">flow</span> <span class="err">'</span><span class="n">PhysicalProjectTree</span> <span class="n">Input</span><span class="p">:</span> <span class="m">108095</span><span class="err">'</span> <span class="n">closed</span> <span class="n">because</span> <span class="n">of</span> <span class="n">an</span> <span class="n">exception</span><span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">AggregateException</span><span class="p">:</span> <span class="n">One</span> <span class="n">or</span> <span class="n">more</span> <span class="n">errors</span> <span class="n">occurred</span><span class="p">.</span> <span class="p">---&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">ArgumentException</span><span class="p">:</span> <span class="n">An</span> <span class="n">item</span> <span class="n">with</span> <span class="n">the</span> <span class="n">same</span> <span class="n">key</span> <span class="n">has</span> <span class="n">already</span> <span class="n">been</span> <span class="n">added</span><span class="p">.</span>
   <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">ThrowHelper</span><span class="p">.</span><span class="nf">ThrowArgumentException</span><span class="p">(</span><span class="n">ExceptionResource</span> <span class="n">resource</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">Dictionary</span><span class="err">`</span><span class="m">2.</span><span class="nf">Insert</span><span class="p">(</span><span class="n">TKey</span> <span class="n">key</span><span class="p">,</span> <span class="n">TValue</span> <span class="k">value</span><span class="p">,</span> <span class="n">Boolean</span> <span class="k">add</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">VisualStudio</span><span class="p">.</span><span class="n">ProjectSystem</span><span class="p">.</span><span class="n">VS</span><span class="p">.</span><span class="n">Tree</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">TreeItemOrderPropertyProvider</span><span class="p">.</span><span class="nf">CreateOrderedMap</span><span class="p">(</span><span class="n">UnconfiguredProject</span> <span class="n">project</span><span class="p">,</span> <span class="n">IReadOnlyCollection</span><span class="err">`</span><span class="m">1</span> <span class="n">orderedItems</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">VisualStudio</span><span class="p">.</span><span class="n">ProjectSystem</span><span class="p">.</span><span class="n">VS</span><span class="p">.</span><span class="n">Tree</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">TreeItemOrderPropertyProvider</span><span class="p">..</span><span class="nf">ctor</span><span class="p">(</span><span class="n">IReadOnlyCollection</span><span class="err">`</span><span class="m">1</span> <span class="n">orderedItems</span><span class="p">,</span> <span class="n">UnconfiguredProject</span> <span class="n">project</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">VisualStudio</span><span class="p">.</span><span class="n">ProjectSystem</span><span class="p">.</span><span class="n">VS</span><span class="p">.</span><span class="n">Tree</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">TreeItemOrderPropertyProviderSource</span><span class="p">.&lt;</span><span class="n">LinkExternalInput</span><span class="p">&gt;</span><span class="nf">b__3_0</span><span class="p">(</span><span class="n">IProjectVersionedValue</span><span class="err">`</span><span class="m">1</span> <span class="n">orderedItems</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Tasks</span><span class="p">.</span><span class="n">Dataflow</span><span class="p">.</span><span class="n">TransformBlock</span><span class="err">`</span><span class="m">2.</span><span class="nf">ProcessMessage</span><span class="p">(</span><span class="n">Func</span><span class="err">`</span><span class="m">2</span> <span class="n">transform</span><span class="p">,</span> <span class="n">KeyValuePair</span><span class="err">`</span><span class="m">2</span> <span class="n">messageWithId</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Tasks</span><span class="p">.</span><span class="n">Dataflow</span><span class="p">.</span><span class="n">TransformBlock</span><span class="err">`</span><span class="m">2.</span><span class="p">&lt;&gt;</span><span class="n">c__DisplayClass10</span><span class="p">.&lt;.</span><span class="n">ctor</span><span class="p">&gt;</span><span class="nf">b__3</span><span class="p">(</span><span class="n">KeyValuePair</span><span class="err">`</span><span class="m">2</span> <span class="n">messageWithId</span><span class="p">)</span>
   <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Tasks</span><span class="p">.</span><span class="n">Dataflow</span><span class="p">.</span><span class="n">Internal</span><span class="p">.</span><span class="n">TargetCore</span><span class="err">`</span><span class="m">1.</span><span class="nf">ProcessMessagesLoopCore</span><span class="p">()</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span>
   <span class="p">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">inner</span> <span class="n">exception</span> <span class="n">stack</span> <span class="n">trace</span> <span class="p">---</span></code></pre></figure>

<p>So the files of these projects had to be fixed.
The improvement consisted in swapping the selected SDK at the beginning of the file from:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"FSharp.NET.Sdk;Microsoft.NET.Sdk"</span><span class="nt">&gt;</span></code></pre></figure>

<p>to:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span></code></pre></figure>

<p>After this amendment I made another attempt to launch the entire solution in Visual Studio. At this point, it was loaded, but the F# projects were not available, only this information appeared:</p>

<p><code class="highlighter-rouge">project file is incomplete. expected imports are missing</code></p>

<p>Dust, delete obj/bin folders for F# projects and C# projects having references for F# projects helped to load the entire solution. Success!</p>

<p>The next step was to build the entire solution. Potentially everything should works fine. Of course, as it happens in such situations, everything did not work.
One of the projects stated that he can not find the dll file of one of the referenced projects. I looked quickly at whether the reference is really added to that project. It turned out that this project has an old csproj file format.
Because of that Visual Studio, shows this information in Solution Explorer:</p>

<p><img src="https://mnie.github.com/img/11-03-2018DrunkVs/properties1.png" alt="properties1" /></p>

<p>and those in the properties of the project:</p>

<p><img src="https://mnie.github.com/img/11-03-2018DrunkVs/properties2.png" alt="properties2" /></p>

<p>For projects with a new csproj file format, all data shown was coherent. So I built the first referenced project, then I built the one that did not want to build a moment ago. It turned out that everything was built correctly.</p>

<p>So it seems that Visual Studio could not keep the order of building projects depending on the references. So I decided that if all projects are in a new format (because it seems that solution which contains a new and old type of cs/fsprojs doesnâ€™t works well), this one should not be different so I changed the old format to a new one, which resulted in the fact that all data shown in Visual Studio in the properties of the solution looks right now like that:</p>

<p><img src="https://mnie.github.com/img/11-03-2018DrunkVs/properties4.png" alt="properties4" /></p>

<p>and in Solution Explorer:</p>

<p><img src="https://mnie.github.com/img/11-03-2018DrunkVs/properties3.png" alt="properties3" /></p>

<p>They are coherent. Therefore, there should be no error in compiling the entire solution related to the wrong order of building projects.</p>

<p>In summary, it is often said that we shouldnâ€™t start/move project to the technologies/libraries/languages which are not mature enough or stable enough.
It could be seen that although the subsequent versions of Visual Studio are described as stable, it is better to always have several versions back to the current version.
But this particular situation helps us to spot a weak points of our cs/fsproj files which in fact are incorrect (double sdk, mixing old and new project formats).</p>

<p>Thank you for reading :)</p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Visual+Studio+15.6.0+vs+.net+like+projects%20-%20http://mnie.me/visualstudiovsfsharp%20by%20@mnie8" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://mnie.me/visualstudiovsfsharp" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://chalk-1.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    2020
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-81299349-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-81299349-1');
  </script>


<script src="/assets/vendor-130c9c254effc51f3283620bc635851da7b99c20901216948f11ba72ee13317f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
